# Reverse Engineering of the Time Calculation App (v2)

This document breaks down the architecture, file structure, and logic of the final version of the Weekly Time Tracker application.

## 1. High-Level Architecture

The application is a purely client-side web application. This means it runs entirely within the user's web browser and does not require an internet connection or a backend server. All logic is handled by JavaScript, all content is structured by HTML, and all styling is managed by CSS.

- **Data Persistence:** The app saves all user data to the browser's `localStorage` under the key `timeDataV5`. This allows the data to persist even when the browser is closed or the page is refreshed.
- **UI Rendering:** The UI is dynamically generated by JavaScript. The main table of categories is built on the fly based on the data found in `localStorage`.
- **Hybrid Event Model:** The application uses a sophisticated hybrid event model for a smooth and robust user experience:
    - The `input` event provides instant, real-time calculation feedback as the user types.
    - The `change` event (which fires after a user finishes editing a field) is used for strict data validation, sanitization (e.g., capping hours at 24), and saving the final, clean data.
- **Custom Modal:** The app replaces the browser's native `confirm()` dialog with a custom-built, styled HTML modal for a more professional and integrated user experience when deleting categories.

## 2. File Structure

The project consists of four core files:

- `index.html`: The main entry point. It defines the page structure, including the table, forms, and the custom modal dialog.
- `style.css`: Contains all visual styling, including layout, colors, fonts, animations (for adding/deleting rows), and the custom modal styles.
- `script.js`: The "brains" of the application, containing all application logic.
- `favicon.svg`: A vector-based icon for the browser tab.

## 3. Data Structure

The application's state is managed in a single JavaScript object, which is then saved to `localStorage` as a JSON string.

The structure is as follows:

```json
{
  "CategoryName1": { "h": 8, "m": 0, "d": 7 },
  "CategoryName2": { "h": 8, "m": 30, "d": 5 }
}
```

- Each key is a string representing the category name (e.g., "Work").
- The value for each category is an object with three properties:
  - `h`: An integer for the hours spent daily.
  - `m`: An integer for the minutes spent daily.
  - `d`: An integer for the number of days per week the activity occurs (from 1 to 7).

## 4. Core JavaScript Logic (`script.js`)

The script is organized into state management, helper functions, data persistence, UI rendering, and event listeners.

### Key Functions

- **`loadData()`**: Called on page load. It retrieves the data from `localStorage` or initializes a default state if no data is found.
- **`saveData()`**: Called whenever the data is changed and finalized. It stringifies the `timeData` object and saves it to `localStorage`.
- **`formatDecimalToTime()`**: A helper function that converts a decimal number (e.g., `8.5`) into a human-readable string (`8h 30m`).
- **`createRow()`**: A factory function that builds the HTML for a single table row based on a category's data.
- **`renderTable()`**: Renders the entire table by clearing it and then calling `createRow()` for every item in `timeData`.
- **`updateRowCalculations()`**: Calculates and updates the weekly total for a single row, and updates the main summary. This is used for real-time feedback.

### Event Handling Logic

- **Add Category (`click` & `keydown`):** The "Add Category" button and the "Enter" key on the input field trigger the addition of a new category to the `timeData` object. The new row is added to the UI with a green "flash" animation.
- **Delete Category (`click`):** The "Delete" button on a row does **not** use a native `confirm()`. Instead, it shows the custom HTML modal (`#modal-overlay`).
    - **Modal Confirm:** Clicking "Delete" on the modal triggers a fast (150ms) fade-out animation on the row. After the animation, the data is removed from `timeData` and the table is re-rendered.
    - **Modal Cancel:** Hides the modal with no further action.
- **Reset All (`click`):** Triggers a native `confirm()` dialog. If the user agrees, it removes the item from `localStorage` and reloads the page, restoring the default state.
- **Hybrid Time Input (`input` & `change`):**
    - **`input` event:** Fires on every keystroke in the `hours`, `minutes`, or `days` fields. It calls `updateRowCalculations()` to provide instant visual feedback on the weekly total and summary, without validating or saving the data. This makes the UI feel fast and responsive.
    - **`change` event:** Fires only after the user has finished editing a field (by clicking away or pressing Enter). This is where the robust validation happens. The code parses the inputs, sanitizes them (e.g., letters become 0, hours are capped at 24), auto-converts minutes over 59 into hours, and caps days at 7. It then updates the input fields to show the corrected values, saves the clean data to `timeData`, and runs a final calculation update.